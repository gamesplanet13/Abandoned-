<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Abandoned Cart WhatsApp Sender</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f4f4f4;
    }
    h2 {
      text-align: center;
    }
    input[type="file"], textarea {
      margin-bottom: 10px;
      display: block;
      width: 100%;
    }
    .progress {
      width: 100%;
      background: #ddd;
      border-radius: 5px;
      margin-bottom: 10px;
    }
    .progress-bar {
      width: 0%;
      height: 20px;
      background: green;
      text-align: center;
      color: white;
      border-radius: 5px;
    }
    .entry {
      background: #fff;
      padding: 10px;
      margin: 5px 0;
      border-radius: 5px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .entry span {
      font-weight: bold;
    }
    button {
      padding: 5px 10px;
      cursor: pointer;
    }
    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <h2>ðŸ“¤ Abandoned Cart WhatsApp Sender</h2>  <input type="file" id="excelFile" accept=".xlsx" />
  <textarea id="messageBox" rows="5" placeholder="Paste your message here..."></textarea>
  <button onclick="generateList()">Generate</button>
  <button onclick="resetSettings()" style="margin-top: 10px; background: crimson; color: white;">Clear Sent Record</button>  <div class="progress">
    <div class="progress-bar" id="progressBar">0%</div>
  </div>  <div id="output"></div>  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.full.min.js"></script>  <script>
    let sentNumbers = JSON.parse(localStorage.getItem("sentNumbers") || "{}");

    function saveSent(number) {
      sentNumbers[number] = true;
      localStorage.setItem("sentNumbers", JSON.stringify(sentNumbers));
    }

    function hasSent(number) {
      return sentNumbers[number];
    }

    function resetSettings() {
      if (confirm("Are you sure you want to clear sent message history?")) {
        localStorage.removeItem("sentNumbers");
        location.reload();
      }
    }

    function generateList() {
      const file = document.getElementById("excelFile").files[0];
      if (!file) return alert("Please upload a file first");

      const reader = new FileReader();
      reader.onload = function (e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: "array" });
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        const rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });

        let headerIndex = -1;
        for (let i = 0; i < rows.length; i++) {
          if (rows[i].includes("Customer Name") && rows[i].includes("Mobile Number")) {
            headerIndex = i;
            break;
          }
        }

        if (headerIndex === -1) return alert("Couldn't find headers in file");

        const headers = rows[headerIndex];
        const nameIndex = headers.indexOf("Customer Name");
        const mobileIndex = headers.indexOf("Mobile Number");

        const outputDiv = document.getElementById("output");
        outputDiv.innerHTML = "";

        const total = rows.length - headerIndex - 1;

        rows.slice(headerIndex + 1).forEach((row, i) => {
          setTimeout(() => {
            const name = row[nameIndex] || "Customer";
            let mobile = (row[mobileIndex] || "").replace(/[^0-9]/g, "");
            if (mobile.length === 10) mobile = "91" + mobile;

            if (mobile.length >= 12) {
              const div = document.createElement("div");
              div.className = "entry";
              const btnId = `btn_${i}`;
              const alreadySent = hasSent(mobile);
              div.innerHTML = `
                <span>${name} - ${mobile}</span>
                <button id="${btnId}" ${alreadySent ? "disabled" : ""}>${alreadySent ? "Sent" : "Send"}</button>
              `;
              if (!alreadySent) {
                div.querySelector("button").onclick = function () {
                  sendMessage(mobile, btnId);
                };
              }
              outputDiv.appendChild(div);
            }

            let percent = Math.floor(((i + 1) / total) * 100);
            document.getElementById("progressBar").style.width = percent + "%";
            document.getElementById("progressBar").innerText = percent + "%";
          }, i * 50);
        });
      };

      reader.readAsArrayBuffer(file);
    }

    function sendMessage(number, buttonId) {
      const msg = encodeURIComponent(document.getElementById("messageBox").value.trim());
      if (!msg) return alert("Please type a message first");

      const btn = document.getElementById(buttonId);
      btn.disabled = true;
      btn.innerText = "Sent";
      saveSent(number);

      window.open(`https://wa.me/${number}?text=${msg}`, "_blank");
    }
  </script></body>
</html>
